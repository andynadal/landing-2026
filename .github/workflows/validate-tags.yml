name: ðŸ·ï¸ Require release label on PRs to main

on:
  pull_request:
    types: [opened, synchronize, reopened, edited, labeled, unlabeled]
    branches: [main]

permissions:
  pull-requests: read

jobs:
  require-release-label:
    runs-on: ubuntu-latest

    steps:
      - name: Validate release label exists (and only one)
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(l => l.name);
            const releaseLabels = labels.filter(l =>
              l === "release:major" || l === "release:minor" || l === "release:patch"
            );

            core.info(`PR #${context.payload.pull_request.number} labels: ${labels.join(", ") || "(none)"}`);
            core.info(`Release labels found: ${releaseLabels.join(", ") || "(none)"}`);

            if (releaseLabels.length === 0) {
              core.setFailed(
                "Missing required release label. Add exactly one of: release:patch | release:minor | release:major"
              );
            }

            if (releaseLabels.length > 1) {
              core.setFailed(
                `Multiple release labels found (${releaseLabels.join(", ")}). Keep exactly one.`
              );
            }
